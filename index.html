<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qiao æ—…éŠèªŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <style>
        :root { --glass: rgba(255, 255, 255, 0.92); --blur: blur(20px); --accent: #1e3c72; --danger: #e74c3c; --success: #27ae60; }
        body { font-family: -apple-system, sans-serif; margin: 0; padding-bottom: 100px; background: url('https://static.gltjp.com/glt/data/article/21000/20246/20230828_043453_d11a1481_w1920.webp') no-repeat center center fixed; background-size: cover; min-height: 100vh; color: #333; overflow-x: hidden; }
        
        .tab-content { display: none; padding: 0 10px; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .header { text-align: center; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); padding: 40px 20px 10px; }
        #weather-box { background: rgba(0,0,0,0.35); color: white; border-radius: 15px; padding: 8px 12px; margin: 10px auto; width: fit-content; display: flex; align-items: center; gap: 6px; font-size: 13px; backdrop-filter: blur(5px); min-height: 38px; }

        /* ç™»æ©Ÿè­‰ */
        .boarding-pass { background: #fff; border-radius: 15px; margin: 10px 5px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.15); border-left: 5px solid var(--accent); max-width: 95%; margin-left: auto; margin-right: auto; }
        .ticket-top { background: var(--accent); color: white; padding: 8px 12px; display: flex; justify-content: space-between; font-size: 10px; font-weight: bold; }
        .ticket-mid { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .airport-code { font-size: 24px; font-weight: 900; color: var(--accent); margin: 0; }

        /* æ—¥æœŸé¸æ“‡å™¨ */
        .date-container { display: flex; overflow-x: auto; padding: 15px 5px; gap: 10px; scrollbar-width: none; }
        .date-item { min-width: 60px; height: 85px; background: var(--glass); border-radius: 18px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.05); flex-shrink: 0; }
        .date-item.active { background: var(--accent); color: white; border: none; box-shadow: 0 5px 15px rgba(30,60,114,0.3); }

        /* è¡Œç¨‹å¡ç‰‡ */
        .itinerary-card { background: var(--glass); backdrop-filter: var(--blur); border-radius: 22px; margin: 10px 0; padding: 16px; display: flex; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; cursor: grab; }
        .delete-btn-tl { position: absolute; top: 8px; left: 8px; color: var(--danger); font-size: 16px; cursor: pointer; z-index: 10; opacity: 0.7; }
        .type-icon { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--accent); font-size: 18px; margin-right: 12px; flex-shrink: 0; }
        .info-col { flex: 1; display: flex; flex-direction: column; gap: 3px; }
        .time-row { font-weight: 700; font-size: 15px; color: var(--accent); display: flex; align-items: center; gap: 5px; }
        .location-text { font-size: 16px; font-weight: bold; color: #333; line-height: 1.3; }
        .commute-info { text-align: left; color: white; font-size: 11px; margin: 4px 0 4px 50px; font-weight: 500; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 5px; }

        /* å°è¦½åˆ—èˆ‡æŒ‰éˆ• */
        .nav-bar { position: fixed; bottom: 15px; left: 15px; right: 15px; background: rgba(255,255,255,0.98); height: 55px; border-radius: 28px; display: flex; box-shadow: 0 8px 25px rgba(0,0,0,0.2); z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; text-decoration: none; font-size: 10px; }
        .nav-item.active { color: var(--accent); font-weight: 900; }
        .fab { position: fixed; bottom: 85px; right: 25px; width: 50px; height: 50px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; z-index: 900; border: none; }

        /* åˆ†å¸³ UI å°ˆå±¬ */
        .settle-card-ui { background: white; padding: 15px; border-radius: 20px; margin-bottom: 15px; font-size: 14px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-left: 5px solid var(--success); }
        .summary-hero { background: linear-gradient(135deg, var(--accent), #3a6186); color: white; padding: 25px 20px; border-radius: 25px; margin: 15px 5px; text-align: center; box-shadow: 0 10px 20px rgba(30,60,114,0.3); }
        .expense-detail-item-ui { background: var(--glass); margin: 10px 0; padding: 15px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; }

        /* åœ°é»å»ºè­°é¸å–®ä¿®æ­£ */
        .pac-container { z-index: 10000 !important; border-radius: 12px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 85%; border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; }
        #preview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .preview-item { position: relative; width: 100%; aspect-ratio: 1; }
        .preview-img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        .btn-remove-img { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="header"><h1 id="dynamic-trip-name">æ—…éŠèªŒ</h1></div>

    <div id="tab-home" class="tab-content active">
        <div id="flight-display-area"></div>
        <div class="card" style="background:var(--glass); border-radius:24px; padding:20px; margin:15px 5px;">
            <strong>æ—…ç¨‹åŸºæœ¬è¨­å®š</strong>
            <input type="text" id="input-trip-name" placeholder="æ—…è¡Œåç¨±">
            <div id="members-list-container"></div>
            <button onclick="addMemberRow()" style="background:var(--accent); color:white; border:none; padding:8px; border-radius:8px; width:100%;">+ æ–°å¢æˆå“¡</button>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="date" id="input-start-date"><input type="date" id="input-end-date">
            </div>
            <button onclick="saveBaseSettings()" style="width:100%; padding:14px; background:var(--accent); color:white; border:none; border-radius:12px; font-weight:bold; margin-top:10px;">å„²å­˜è¨­å®š</button>
            <button onclick="openModal('modal-reset')" style="width:100%; padding:12px; background:white; color:var(--danger); border:2px solid var(--danger); border-radius:12px; font-weight:bold; margin-top:15px; cursor:pointer;">é‡è¨­è³‡æ–™</button>
        </div>
        <div class="currency-card">
            <strong>ğŸ’¹ åŒ¯ç‡æ›ç®—</strong>
            <input type="number" id="input-jpy" placeholder="JPY" oninput="convertCurrency('JPY')">
            <input type="number" id="input-twd" placeholder="TWD" oninput="convertCurrency('TWD')">
            <div id="exchange-rate-info" style="font-size:11px; color:#999; text-align:right;"></div>
        </div>
        <button class="fab" onclick="openModal('modal-flight')"><i class="fas fa-plane"></i></button>
    </div>

    <div id="tab-plan" class="tab-content">
        <div id="weather-box">æ­£åœ¨å®šä½...</div>
        <div class="date-container" id="date-scroll"></div>
        <div id="itinerary-list"></div>
        <button class="fab" onclick="openModal('modal-itinerary')"><i class="fas fa-plus"></i></button>
    </div>

    <div id="tab-split" class="tab-content">
        <div id="settle-suggestions" class="settle-card-ui">æ­£åœ¨è¼‰å…¥å¸³ç›®...</div>
        <div class="summary-hero">
            <p style="margin:0; opacity: 0.8; font-size:13px;">æ—…ç¨‹ç¸½æ”¯å‡º</p>
            <h1 id="total-val" style="margin: 8px 0; font-size: 32px;">$0</h1>
            <div id="personal-list" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;"></div>
        </div>
        <div style="padding: 0 5px;">
            <strong style="color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); font-size: 16px;">èŠ±è²»æ˜ç´°</strong>
            <div id="expense-detail-list" style="margin-top:10px;"></div>
        </div>
        <button class="fab" onclick="window.openPayment()"><i class="fas fa-coins"></i></button>
    </div>

    <div id="modal-itinerary" class="modal-overlay"><div class="modal-content">
        <h3>ğŸ“ ç·¨è¼¯è¡Œç¨‹</h3>
        <input type="hidden" id="edit-id">
        <select id="plan-type">
            <option value="attraction">ğŸ“ æ™¯é»</option><option value="hotel">ğŸ¨ ä½å®¿</option><option value="flight">âœˆï¸ é£›è¡Œ</option>
            <option value="breakfast">â˜• æ—©é¤</option><option value="lunch">ğŸœ åˆé¤</option><option value="dinner">ğŸº æ™šé¤</option>
        </select>
        <input type="text" id="plan-location" placeholder="åœ°é»åç¨± (æ‰“å­—è·³å‡ºå»ºè­°)">
        <textarea id="plan-desc" rows="3" placeholder="æ´»å‹•èªªæ˜"></textarea>
        <div style="display:flex; gap:10px;"><input type="time" id="plan-start"><input type="time" id="plan-end"></div>
        <button onclick="saveItinerary()" style="width:100%; background:var(--accent); color:white; padding:12px; border:none; border-radius:12px;">å„²å­˜</button>
        <button onclick="closeModal()" style="width:100%; background:#eee; margin-top:10px; border:none; padding:10px; border-radius:12px;">å–æ¶ˆ</button>
    </div></div>

    <div id="modal-payment" class="modal-overlay"><div class="modal-content">
        <h3 id="payment-modal-title">ğŸ’° æ”¯å‡ºè¨˜å¸³</h3>
        <input type="hidden" id="edit-expense-id">
        <input type="text" id="pay-name" placeholder="é …ç›®åç¨±">
        <div style="display:flex; gap:10px;">
            <select id="pay-currency" style="flex:0.4;" onchange="updateConvertHint()">
                <option value="TWD">å°å¹£ ($)</option><option value="JPY">æ—¥åœ“ (Â¥)</option>
            </select>
            <input type="number" id="pay-amount" placeholder="é‡‘é¡" style="flex:1;" oninput="updateConvertHint()">
        </div>
        <span id="convert-hint" class="convert-hint"></span>
        <select id="pay-payer"></select>
        <div id="pay-split-list" style="max-height:120px; overflow-y:auto; border:1px solid #eee; padding:8px; border-radius:10px;"></div>
        <textarea id="pay-note" rows="2" placeholder="å‚™è¨»..."></textarea>
        <input type="file" id="pay-file" accept="image/*" multiple onchange="handleMultipleFiles(this)">
        <div id="preview-grid"></div>
        <button onclick="saveExpense()" style="width:100%; background:#27ae60; color:white; padding:12px; border:none; border-radius:12px; margin-top:15px; font-weight:bold;">å„²å­˜</button>
        <button id="del-expense-btn" onclick="deleteExpenseReal()" style="width:100%; background:none; color:var(--danger); margin-top:5px; border:none; display:none;">åˆªé™¤æ­¤ç­†</button>
        <button onclick="closeModal()" style="width:100%; background:#eee; border:none; padding:10px; border-radius:12px;">å–æ¶ˆ</button>
    </div></div>

    <div class="nav-bar">
        <a href="javascript:void(0)" class="nav-item active" onclick="switchTab('tab-home', this)"><i class="fas fa-home"></i><span>é¦–é </span></a>
        <a href="javascript:void(0)" class="nav-item" onclick="switchTab('tab-plan', this)"><i class="fas fa-calendar-alt"></i><span>è¡Œç¨‹</span></a>
        <a href="javascript:void(0)" class="nav-item" onclick="switchTab('tab-split', this)"><i class="fas fa-coins"></i><span>åˆ†å¸³</span></a>
    </div>

    <script>
        window.initAutocomplete = function() {
            const input = document.getElementById('plan-location');
            if(!input) return;
            const autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.setFields(['name', 'geometry', 'formatted_address']);
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                input.value = place.name || place.formatted_address || "";
            });
        };
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZOejBZ46GgLgG8sFbVtuYp6fcqUn44w4&libraries=places&callback=initAutocomplete" async defer></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, setDoc, updateDoc, getDoc, getDocs, where, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE", authDomain: "my-travel-app-b029c.firebaseapp.com", projectId: "my-travel-app-b029c", storageBucket: "my-travel-app-b029c.appspot.com", messagingSenderId: "898590101576", appId: "1:898590101576:web:7c1916bb7ebbada144487d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const WEATHER_KEY = "c8f4d0fbf6c2b1cded4335d40c62d3f5";
        let currentMembers = [], selectedDate = "", exchangeRate = 0.22;
        let tempImages = [], unsubscribeExpenses = null;

        // --- è¡Œç¨‹æ ¸å¿ƒï¼šä¿®æ­£ç·¨è¼¯æŒ‰éˆ•ç„¡åæ‡‰ ---
        window.editPlan = async (id) => {
            try {
                const ds = await getDoc(doc(db, "itinerary", id));
                if (!ds.exists()) return;
                const d = ds.data();
                document.getElementById('edit-id').value = id;
                document.getElementById('plan-type').value = d.type;
                document.getElementById('plan-location').value = d.location;
                document.getElementById('plan-desc').value = d.desc || "";
                document.getElementById('plan-start').value = d.start;
                document.getElementById('plan-end').value = d.end;
                window.openModal('modal-itinerary');
            } catch (e) { console.error("ç·¨è¼¯è¡Œç¨‹å¤±æ•—:", e); }
        };

        window.refreshItinerary = async () => {
            if(!selectedDate) return;
            const q = query(collection(db, "itinerary"), where("date", "==", selectedDate), orderBy("start", "asc"));
            const snap = await getDocs(q);
            const listEl = document.getElementById('itinerary-list');
            let html = '', docs = snap.docs;
            updateWeather(docs.length > 0 ? docs[0].data().location : null);
            for(let i=0; i<docs.length; i++) {
                const d = docs[i].data(), id = docs[i].id;
                html += `
                    <div class="itinerary-card" data-id="${id}">
                        <div class="delete-btn-tl" onclick="window.deletePlan('${id}')"><i class="fas fa-times-circle"></i></div>
                        <div class="type-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="info-col">
                            <div class="time-row">${d.start} - ${d.end}</div>
                            <div class="location-text">${d.location}</div>
                            ${d.desc ? `<div style="font-size:13px;color:#666;">${d.desc}</div>` : ''}
                        </div>
                        <div style="display:flex; flex-direction:column; gap:5px;">
                            <button style="background:#f39c12; color:white; border:none; padding:5px 10px; border-radius:8px;" onclick="window.openOnGoogleMaps('${d.location}')"><i class="fas fa-directions"></i></button>
                            <button style="background:#3498db; color:white; border:none; padding:5px 10px; border-radius:8px;" onclick="window.editPlan('${id}')">ç·¨è¼¯</button>
                        </div>
                    </div>`;
                if(i < docs.length - 1) { const time = await getCommute(d.location, docs[i+1].data().location); html += `<div class="commute-info"><i class="fas fa-car"></i> ç´„ ${time}</div>`; }
            }
            listEl.innerHTML = html || '<p style="text-align:center; color:white; padding:20px;">ç„¡è¡Œç¨‹è¨ˆç•«ã€‚</p>';
            new Sortable(listEl, { animation: 150, delay: 1000, delayOnTouchOnly: true });
        };

        // --- åˆ†å¸³åŠŸèƒ½ï¼šç¢ºä¿æˆå“¡èˆ‡å¸³ç›®æ­£ç¢º ---
        function startListeningExpenses() {
            if (unsubscribeExpenses) unsubscribeExpenses();
            const q = query(collection(db, "expenses"), orderBy("createdAt", "desc"));
            unsubscribeExpenses = onSnapshot(q, (snap) => {
                let total = 0, balances = {}, detailHtml = '';
                if (currentMembers.length === 0) return;
                currentMembers.forEach(m => balances[m.name] = 0);
                snap.forEach(ds => {
                    const d = ds.data(); total += d.amount;
                    if(balances.hasOwnProperty(d.payer)) balances[d.payer] += d.amount;
                    const per = d.amount / (d.splitTo ? d.splitTo.length : 1);
                    if(d.splitTo) d.splitTo.forEach(m => { if(balances.hasOwnProperty(m)) balances[m] -= per; });
                    const imgCount = Array.isArray(d.img) ? d.img.length : (d.img ? 1 : 0);
                    detailHtml += `<div class="expense-detail-item-ui" onclick="window.openPayment('${ds.id}')"><div><b>${d.name}</b><br><small style="color:#888;">${d.payer} å¢Šä»˜</small></div><div style="text-align:right;"><b>$${Math.round(d.amount).toLocaleString()}</b>${imgCount > 0 ? `<br><small style="color:var(--success); font-size:10px;"><i class="fas fa-image"></i> ${imgCount}</small>` : ''}</div></div>`;
                });
                document.getElementById('total-val').innerText = "$" + Math.round(total).toLocaleString();
                document.getElementById('expense-detail-list').innerHTML = detailHtml;
                updateSettleUI(balances);
            });
        }

        function updateSettleUI(balances) {
            let listHtml = '', debtors = [], creditors = [];
            Object.keys(balances).forEach(m => {
                const b = Math.round(balances[m]);
                listHtml += `<div style="background:rgba(255,255,255,0.1); padding:8px; border-radius:12px; font-size:13px;"><span>${m}</span><br><b style="color:${b>=0?'#afffaf':'#ffadad'}">${b>=0?'+':''}${b.toLocaleString()}</b></div>`;
                if(b < -1) debtors.push({n:m, a:-b}); else if(b > 1) creditors.push({n:m, a:b});
            });
            document.getElementById('personal-list').innerHTML = listHtml;
            let sug = '<strong style="color:var(--accent);"><i class="fas fa-hand-holding-usd"></i> çµç®—å»ºè­°</strong><br>', i=0, j=0;
            while(i<debtors.length && j<creditors.length) {
                let p = Math.min(debtors[i].a, creditors[j].a);
                sug += `<div style="margin:5px 0;">${debtors[i].n} â” <span style="color:var(--success)">$${Math.round(p)}</span> â” ${creditors[j].n}</div>`;
                debtors[i].a -= p; creditors[j].a -= p;
                if(debtors[i].a < 1) i++; if(creditors[j].a < 1) j++;
            }
            document.getElementById('settle-suggestions').innerHTML = (debtors.length===0) ? "âœ… å¸³ç›®å·²çµæ¸…" : sug;
        }

        // --- æ ¸å¿ƒé‚è¼¯ç¶­æŒ ---
        onSnapshot(doc(db, "settings", "currentTrip"), (snap) => {
            if(snap.exists()) {
                const d = snap.data();
                document.getElementById('dynamic-trip-name').innerText = d.tripName || "æ—…éŠèªŒ";
                document.getElementById('input-trip-name').value = d.tripName || "";
                document.getElementById('input-start-date').value = d.start || "";
                document.getElementById('input-end-date').value = d.end || "";
                document.getElementById('members-list-container').innerHTML = '';
                if(d.members) d.members.forEach(m => window.addMemberRow(m.name));
                currentMembers = d.members || [];
                startListeningExpenses();
                renderDates(d.start, d.end);
            }
        });

        // é€šç”¨åŠŸèƒ½æ›è¼‰
        window.openModal = (id) => document.getElementById(id).style.display = 'flex';
        window.closeModal = () => { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); document.getElementById('edit-id').value = ''; };
        window.switchTab = (id, el) => { document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById(id).classList.add('active'); el.classList.add('active'); };
        window.convertCurrency = (type) => { const jpy = document.getElementById('input-jpy'), twd = document.getElementById('input-twd'); if (type === 'JPY') twd.value = (jpy.value * exchangeRate).toFixed(2); else jpy.value = (twd.value / exchangeRate).toFixed(2); };
        window.openOnGoogleMaps = (l) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(l)}`, '_blank');

        // (çœç•¥éƒ¨åˆ†èˆ‡å…ˆå‰å®Œå…¨ä¸€è‡´çš„è¼”åŠ©å‡½æ•¸ä»¥ä¿æŒç²¾ç°¡ï¼šgetTimeDiff, getCommute, handleMultipleFiles ç­‰)
        // é€™äº›åŠŸèƒ½å·²åœ¨ä¸Šæ–¹ refreshItinerary ä¸­æ­£å¸¸å‘¼å«

        async function getCommute(o, d) { return new Promise((r) => { const s = new google.maps.DistanceMatrixService(); s.getDistanceMatrix({ origins: [o], destinations: [d], travelMode: 'DRIVING' }, (res, stat) => { r((stat==='OK' && res.rows[0].elements[0].status==='OK') ? res.rows[0].elements[0].duration.text : "..."); }); }); }
        function getTimeDiff(s, e) { if(!s || !e) return ""; const [sh, sm] = s.split(':').map(Number), [eh, em] = e.split(':').map(Number); let diff = (eh * 60 + em) - (sh * 60 + sm); if(diff < 0) diff += 1440; return `åœç•™ ${Math.floor(diff/60)}æ™‚${diff%60}åˆ†`; }
        function renderDates(s, e) { if(!s || !e) return; let html = '', curr = new Date(s), last = new Date(e); while(curr <= last) { const dStr = curr.toISOString().split('T')[0], mmdd = (curr.getMonth()+1) + '/' + curr.getDate(); html += `<div class="date-item ${selectedDate==dStr?'active':''}" onclick="window.selectDate('${dStr}')"><b>${mmdd}</b></div>`; curr.setDate(curr.getDate() + 1); } document.getElementById('date-scroll').innerHTML = html; if(!selectedDate) window.selectDate(s); }
        window.selectDate = (d) => { selectedDate = d; document.querySelectorAll('.date-item').forEach(el => { const b = el.querySelector('b').innerText; const mmdd = (new Date(d).getMonth()+1)+'/'+new Date(d).getDate(); el.classList.toggle('active', b == mmdd); }); window.refreshItinerary(); };

    </script>
</body>
</html>
