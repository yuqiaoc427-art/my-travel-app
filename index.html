<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠåŠ©æ‰‹ App</title>
    <style>
        :root { --primary: #007bff; --bg: #f8f9fa; }
        body { font-family: sans-serif; margin: 0; padding-bottom: 70px; background: var(--bg); }
        
        /* é ç±¤å…§å®¹æ§åˆ¶ */
        .tab-content { display: none; padding: 15px; }
        .tab-content.active { display: block; }

        /* åº•éƒ¨å°è¦½åˆ— */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { flex: 1; text-align: center; padding: 15px 0; cursor: pointer; color: #666; font-weight: bold; }
        .nav-item.active { color: var(--primary); border-top: 3px solid var(--primary); }

        /* è¡¨æ ¼æ¨£å¼ */
        .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { border-bottom: 2px solid #eee; padding: 10px; text-align: left; background: #fff; position: sticky; top: 0; }
        td { border-bottom: 1px solid #eee; padding: 10px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; }

        /* è²»ç”¨åˆ†æ”¤æ¨£å¼ */
        .split-box { text-align: center; padding: 20px; }
        .total-val { font-size: 32px; color: #d9534f; font-weight: bold; }
    </style>
</head>
<body>

    <div id="tab-plan" class="tab-content active">
        <div class="card">
            <strong>â• æ–°å¢è¡Œç¨‹</strong>
            <input type="date" id="date">
            <input type="text" id="time" placeholder="æ™‚é–“(09:00)">
            <input type="text" id="activity" placeholder="åœ°é»/æ´»å‹•">
            <input type="text" id="note" placeholder="å‚™è¨»">
            <input type="number" id="cost" placeholder="é‡‘é¡">
            <button id="saveBtn">æ–°å¢</button>
        </div>
        
        <div class="card" style="overflow-x: auto;">
            <table>
                <thead><tr><th>æ—¥æœŸ</th><th>åœ°é»</th><th>è²»ç”¨</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="list-body"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-split" class="tab-content">
        <div class="card split-box">
            <p>ç¸½èŠ±è²»é‡‘é¡</p>
            <div class="total-val" id="total-val">$0</div>
            <hr>
            <p>åˆ†æ”¤äººæ•¸</p>
            <input type="number" id="people-count" value="2" oninput="calculateSplit()">
            <p style="margin-top:20px;">æ¯äººæ‡‰ä»˜</p>
            <div class="total-val" id="per-person" style="color: #28a745;">$0</div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('tab-plan', this)">ğŸ—ºï¸ è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchTab('tab-split', this)">ğŸ’° åˆ†æ”¤</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE",
            authDomain: "my-travel-app-b029c.firebaseapp.com",
            projectId: "my-travel-app-b029c",
            storageBucket: "my-travel-app-b029c.firebasestorage.app",
            messagingSenderId: "898590101576",
            appId: "1:898590101576:web:7c1916bb7ebbada144487d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let globalTotal = 0;

        // åˆ‡æ›åˆ†é é‚è¼¯
        window.switchTab = (tabId, el) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            el.classList.add('active');
        };

        // å„²å­˜åŠŸèƒ½
        document.getElementById('saveBtn').onclick = async () => {
            const date = document.getElementById('date').value;
            const activity = document.getElementById('activity').value;
            if(!date || !activity) return alert("è«‹å¡«å¯«æ—¥æœŸèˆ‡åœ°é»");
            
            await addDoc(collection(db, "trips"), {
                date, activity, 
                time: document.getElementById('time').value,
                note: document.getElementById('note').value,
                cost: Number(document.getElementById('cost').value || 0),
                createdAt: new Date()
            });
            ['time','activity','note','cost'].forEach(id => document.getElementById(id).value = '');
        };

        // åˆªé™¤åŠŸèƒ½
        window.deleteItem = async (id) => {
            if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) await deleteDoc(doc(db, "trips", id));
        };

        // è¨ˆç®—åˆ†æ”¤
        window.calculateSplit = () => {
            const people = document.getElementById('people-count').value || 1;
            const perPerson = globalTotal / people;
            document.getElementById('per-person').innerText = '$' + Math.round(perPerson).toLocaleString();
        };

        // è®€å–è³‡æ–™
        const q = query(collection(db, "trips"), orderBy("date", "asc"), orderBy("time", "asc"));
        onSnapshot(q, (snapshot) => {
            let html = '';
            globalTotal = 0;
            snapshot.forEach(doc => {
                const data = doc.data();
                html += `<tr>
                    <td>${data.date}<br><small>${data.time}</small></td>
                    <td><b>${data.activity}</b><br><small>${data.note}</small></td>
                    <td>$${data.cost}</td>
                    <td><button onclick="deleteItem('${doc.id}')" style="background:none; color:red; width:auto; border:none; padding:0">âœ•</button></td>
                </tr>`;
                globalTotal += Number(data.cost);
            });
            document.getElementById('list-body').innerHTML = html;
            document.getElementById('total-val').innerText = '$' + globalTotal.toLocaleString();
            calculateSplit();
        });
    </script>
</body>
</html>
