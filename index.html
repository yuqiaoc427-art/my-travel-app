<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner</title>
    <style>
        :root {
            --bg-color: #f6f8fa;
            --accent-color: #007AFF; /* 經典 iOS 藍 */
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --card-bg: #ffffff;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            margin: 0; 
            padding: env(safe-area-inset-top) 20px 100px 20px; 
        }

        /* 頂部標題 */
        .app-header {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .app-header h1 { margin: 0; font-size: 28px; font-weight: 800; }
        .total-badge { 
            background: var(--accent-color); 
            color: white; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 600;
        }

        /* 輸入區域卡片化 */
        .input-section {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .input-section input {
            width: 100%;
            border: none;
            padding: 10px 0;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            font-size: 15px;
            outline: none;
        }
        .add-btn {
            background: var(--accent-color);
            color: white;
            width: 100%;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* 行程卡片設計 */
        .date-group {
            margin-bottom: 25px;
        }
        .date-title {
            font-size: 14px;
            color: var(--text-sub);
            font-weight: 600;
            margin-bottom: 10px;
            padding-left: 5px;
        }
        .trip-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-left { flex: 1; }
        .card-time { color: var(--accent-color); font-size: 13px; font-weight: 700; margin-bottom: 4px; }
        .card-activity { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
        .card-note { color: var(--text-sub); font-size: 13px; }
        
        .card-right { text-align: right; margin-left: 10px; }
        .card-cost { font-weight: 700; color: #ff3b30; margin-bottom: 8px; }
        .file-link { 
            color: var(--accent-color); 
            text-decoration: none; 
            font-size: 12px; 
            background: #eef6ff;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .btn-del { color: #ccc; border: none; background: none; font-size: 18px; margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-header">
    <div>
        <small style="color:var(--text-sub)">我的旅行</small>
        <h1>行程規劃</h1>
    </div>
    <div class="total-badge" id="total-sum">$0</div>
</div>

<div class="input-section">
    <input type="date" id="date">
    <input type="text" id="time" placeholder="時間 (例 10:30)">
    <input type="text" id="activity" placeholder="要去哪裡？">
    <input type="text" id="note" placeholder="備註 (飯店、票券編號)">
    <input type="number" id="cost" placeholder="花費金額">
    <input type="text" id="fileUrl" placeholder="檔案連結 (Google Drive)">
    <button class="add-btn" onclick="saveData()">確認新增</button>
</div>

<div id="trip-list">
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE",
        authDomain: "my-travel-app-b029c.firebaseapp.com",
        projectId: "my-travel-app-b029c",
        storageBucket: "my-travel-app-b029c.firebasestorage.app",
        messagingSenderId: "898590101576",
        appId: "1:898590101576:web:7c1916bb7ebbada144487d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveData = async () => {
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const activity = document.getElementById('activity').value;
        const note = document.getElementById('note').value;
        const cost = document.getElementById('cost').value || 0;
        const fileUrl = document.getElementById('fileUrl').value;

        if(date && activity) {
            await addDoc(collection(db, "trips"), {
                date, time, activity, note, cost: parseFloat(cost), fileUrl, createdAt: new Date()
            });
            ['time', 'activity', 'note', 'cost', 'fileUrl'].forEach(id => document.getElementById(id).value = '');
        } else {
            alert("請填寫日期與地點");
        }
    };

    window.deleteItem = async (id) => {
        if(confirm("確定刪除？")) await deleteDoc(doc(db, "trips", id));
    };

    const q = query(collection(db, "trips"), orderBy("date", "asc"), orderBy("time", "asc"));
    onSnapshot(q, (snapshot) => {
        let html = '';
        let total = 0;
        let lastDate = "";

        snapshot.forEach(doc => {
            const data = doc.data();
            
            // 日期分組顯示
            if (data.date !== lastDate) {
                html += `<div class="date-title">${data.date}</div>`;
                lastDate = data.date;
            }

            const costText = data.cost > 0 ? `<div class="card-cost">$${data.cost}</div>` : '';
            const fileBtn = data.fileUrl ? `<a href="${data.fileUrl}" target="_blank" class="file-link">查看附件</a>` : '';

            html += `
                <div class="trip-card">
                    <div class="card-left">
                        <div class="card-time">${data.time}</div>
                        <div class="card-activity">${data.activity}</div>
                        <div class="card-note">${data.note}</div>
                        ${fileBtn}
                    </div>
                    <div class="card-right">
                        ${costText}
                        <button class="btn-del" onclick="deleteItem('${doc.id}')">×</button>
                    </div>
                </div>`;
            total += data.cost;
        });
        document.getElementById('trip-list').innerHTML = html;
        document.getElementById('total-sum').innerText = '$' + total.toLocaleString();
    });
</script>

</body>
</html>
