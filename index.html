<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ—…éŠè¡Œç¨‹è¡¨</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #fdfdfd; }
        .header { background: #333; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; }
        .input-section { background: #eee; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .input-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .input-group input { flex: 1; min-width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button#saveBtn { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 4px; margin-top: 10px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; min-width: 500px; font-size: 14px; }
        th { background: #555; color: white; padding: 10px; text-align: left; }
        td { border-bottom: 1px solid #eee; padding: 10px; }
        .btn-del { color: #ff4444; border: 1px solid #ff4444; background: none; padding: 2px 5px; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0">æˆ‘çš„æ—…éŠè¡Œç¨‹è¡¨</h2>
        <div>ç¸½æ”¯å‡ºï¼š<span id="total-amount">$0</span></div>
    </div>

    <div class="input-section">
        <strong>â• æ–°å¢è¡Œç¨‹</strong>
        <div class="input-group">
            <input type="date" id="date">
            <input type="text" id="time" placeholder="æ™‚é–“(09:00)">
            <input type="text" id="activity" placeholder="åœ°é»/æ´»å‹•">
            <input type="text" id="note" placeholder="å‚™è¨»">
            <input type="number" id="cost" placeholder="è²»ç”¨">
            <input type="text" id="fileUrl" placeholder="æª”æ¡ˆé€£çµ">
        </div>
        <button id="saveBtn">æ–°å¢è‡³æ¸…å–®</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>åœ°é»</th><th>å‚™è¨»/æª”æ¡ˆ</th><th>è²»ç”¨</th><th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="list-body"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE",
            authDomain: "my-travel-app-b029c.firebaseapp.com",
            projectId: "my-travel-app-b029c",
            storageBucket: "my-travel-app-b029c.firebasestorage.app",
            messagingSenderId: "898590101576",
            appId: "1:898590101576:web:7c1916bb7ebbada144487d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // æ”¹ç”¨ç›£è½å™¨æ–¹å¼ï¼Œè§£æ±º saveData is not defined çš„å•é¡Œ
        document.getElementById('saveBtn').addEventListener('click', async () => {
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const activity = document.getElementById('activity').value;
            const note = document.getElementById('note').value;
            const cost = document.getElementById('cost').value || 0;
            const fileUrl = document.getElementById('fileUrl').value;

            if(date && activity) {
                try {
                    await addDoc(collection(db, "trips"), { 
                        date, time, activity, note, cost: parseFloat(cost), fileUrl, createdAt: new Date() 
                    });
                    // æ¸…ç©ºæ¬„ä½
                    ['time', 'activity', 'note', 'cost', 'fileUrl'].forEach(id => document.getElementById(id).value = '');
                } catch (e) {
                    alert("å„²å­˜å¤±æ•—ï¼š" + e.message);
                }
            } else {
                alert("è«‹å¡«å¯«æ—¥æœŸèˆ‡åœ°é»");
            }
        });

        // åˆªé™¤åŠŸèƒ½
        window.deleteItem = async (id) => {
            if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) await deleteDoc(doc(db, "trips", id));
        };

        // è®€å–è³‡æ–™
        const q = query(collection(db, "trips"), orderBy("date", "asc"), orderBy("time", "asc"));
        onSnapshot(q, (snapshot) => {
            let html = '';
            let total = 0;
            snapshot.forEach(doc => {
                const data = doc.data();
                const fileLink = data.fileUrl ? `<br><a href="${data.fileUrl}" target="_blank">ğŸ”— æª”æ¡ˆ</a>` : '';
                html += `<tr>
                    <td>${data.date}</td>
                    <td>${data.time}</td>
                    <td><b>${data.activity}</b></td>
                    <td>${data.note}${fileLink}</td>
                    <td>$${data.cost}</td>
                    <td><button class="btn-del" onclick="deleteItem('${doc.id}')">âœ•</button></td>
                </tr>`;
                total += Number(data.cost);
            });
            document.getElementById('list-body').innerHTML = html;
            document.getElementById('total-amount').innerText = '$' + total.toLocaleString();
        });
    </script>
</body>
</html>
