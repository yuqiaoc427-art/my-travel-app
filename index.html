<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…éŠè¡Œç¨‹è¡¨</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #fdfdfd; }
        .header { background: #333; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; }
        
        /* è¼¸å…¥å€åŸŸ */
        .input-section { background: #eee; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        .input-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .input-group input { flex: 1; min-width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; margin-top: 10px; cursor: pointer; font-weight: bold; }

        /* è¡¨æ ¼è¨­è¨ˆ */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; min-width: 500px; font-size: 14px; }
        th { background: #555; color: white; padding: 10px; text-align: left; }
        td { border-bottom: 1px solid #eee; padding: 10px; vertical-align: top; }
        tr:nth-child(even) { background: #fafafa; }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .cost-text { color: #d9534f; font-weight: bold; }
        .link-text { color: #0275d8; text-decoration: none; font-size: 12px; }
        .btn-del { color: #ccc; border: none; background: none; cursor: pointer; float: right; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0">æˆ‘çš„æ—…éŠè¡Œç¨‹è¡¨</h2>
        <div style="font-size: 14px; margin-top:5px;">ç¸½æ”¯å‡ºï¼š<span id="total-amount">$0</span></div>
    </div>

    <div class="input-section">
        <strong>â• æ–°å¢è¡Œç¨‹</strong>
        <div class="input-group">
            <input type="date" id="date">
            <input type="text" id="time" placeholder="æ™‚é–“(09:00)">
            <input type="text" id="activity" placeholder="åœ°é»/æ´»å‹•">
            <input type="text" id="note" placeholder="å‚™è¨»(è¨‚æˆ¿è™Ÿç­‰)">
            <input type="number" id="cost" placeholder="è²»ç”¨">
            <input type="text" id="fileUrl" placeholder="æª”æ¡ˆé€£çµ">
        </div>
        <button onclick="saveData()">æ–°å¢è‡³æ¸…å–®</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th width="15%">æ—¥æœŸ</th>
                    <th width="12%">æ™‚é–“</th>
                    <th width="25%">åœ°é»</th>
                    <th width="30%">å‚™è¨»/æª”æ¡ˆ</th>
                    <th width="18%">è²»ç”¨</th>
                </tr>
            </thead>
            <tbody id="list-body">
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE",
            authDomain: "my-travel-app-b029c.firebaseapp.com",
            projectId: "my-travel-app-b029c",
            storageBucket: "my-travel-app-b029c.firebasestorage.app",
            messagingSenderId: "898590101576",
            appId: "1:898590101576:web:7c1916bb7ebbada144487d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // å­˜æª”åŠŸèƒ½
        window.saveData = async () => {
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const activity = document.getElementById('activity').value;
            const note = document.getElementById('note').value;
            const cost = document.getElementById('cost').value || 0;
            const fileUrl = document.getElementById('fileUrl').value;

            if(date && activity) {
                await addDoc(collection(db, "trips"), { 
                    date, time, activity, note, cost: parseFloat(cost), fileUrl, createdAt: new Date() 
                });
                ['time', 'activity', 'note', 'cost', 'fileUrl'].forEach(id => document.getElementById(id).value = '');
            } else {
                alert("è«‹è‡³å°‘è¼¸å…¥æ—¥æœŸèˆ‡åœ°é»ï¼");
            }
        };

        // åˆªé™¤åŠŸèƒ½
        window.deleteItem = async (id) => {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¡Œç¨‹å—ï¼Ÿ")) {
                await deleteDoc(doc(db, "trips", id));
            }
        };

        // å³æ™‚è®€å–
        const q = query(collection(db, "trips"), orderBy("date", "asc"), orderBy("time", "asc"));
        onSnapshot(q, (snapshot) => {
            let html = '';
            let total = 0;
            snapshot.forEach(doc => {
                const data = doc.data();
                const fileLink = data.fileUrl ? `<br><a href="${data.fileUrl}" target="_blank" class="link-text">ğŸ”— æŸ¥çœ‹æª”æ¡ˆ</a>` : '';
                
                html += `
                    <tr>
                        <td>${data.date}</td>
                        <td>${data.time}</td>
                        <td><b>${data.activity}</b></td>
                        <td>${data.note}${fileLink}</td>
                        <td>
                            <span class="cost-text">$${data.cost}</span>
                            <button class="btn-del" onclick="deleteItem('${doc.id}')">âœ•</button>
                        </td>
                    </tr>`;
                total += data.cost;
            });
            document.getElementById('list-body').innerHTML = html;
            document.getElementById('total-amount').innerText = '$' + total.toLocaleString();
        });
    </script>
</body>
</html>
