<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅遊小幫手</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; line-height: 1.5; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007AFF; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .trip-item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; }
        .date-title { font-weight: bold; color: #555; margin-top: 20px; border-left: 4px solid #007AFF; padding-left: 10px; }
    </style>
</head>
<body>

    <h2>✈️ 旅遊行程規劃</h2>
    <div id="status-msg" style="color: red; font-size: 12px;"></div>

    <div class="card">
        <input type="date" id="date">
        <input type="text" id="time" placeholder="時間 (例如 10:00)">
        <input type="text" id="activity" placeholder="行程地點">
        <input type="number" id="cost" placeholder="花費金額">
        <button onclick="saveData()">儲存行程</button>
    </div>

    <div id="list-container">載入中...</div>

    <script type="module">
        // 捕捉錯誤，如果程式碼壞掉會顯示在網頁上
        window.onerror = function(msg) {
            document.getElementById('status-msg').innerText = "語法錯誤: " + msg;
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcXPvCma5TilSjZfAGYJg8n8ZfAAsqNtE",
            authDomain: "my-travel-app-b029c.firebaseapp.com",
            projectId: "my-travel-app-b029c",
            storageBucket: "my-travel-app-b029c.firebasestorage.app",
            messagingSenderId: "898590101576",
            appId: "1:898590101576:web:7c1916bb7ebbada144487d"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            window.saveData = async () => {
                const date = document.getElementById('date').value;
                const activity = document.getElementById('activity').value;
                if (!date || !activity) return alert("請填寫日期與地點");
                
                await addDoc(collection(db, "trips"), {
                    date,
                    time: document.getElementById('time').value,
                    activity,
                    cost: parseFloat(document.getElementById('cost').value || 0),
                    createdAt: new Date()
                });
                alert("儲存成功！");
            };

            const q = query(collection(db, "trips"), orderBy("date", "asc"));
            onSnapshot(q, (snapshot) => {
                let html = '';
                snapshot.forEach(doc => {
                    const d = doc.data();
                    html += `<div class="trip-item">
                                <div><b>${d.date} ${d.time}</b><br>${d.activity}</div>
                                <div style="color:red">$${d.cost}</div>
                             </div>`;
                });
                document.getElementById('list-container').innerHTML = html || "目前沒有行程";
            }, (error) => {
                document.getElementById('status-msg').innerText = "資料庫連接失敗: " + error.message;
            });

        } catch (e) {
            document.getElementById('status-msg').innerText = "初始化錯誤: " + e.message;
        }
    </script>
</body>
</html>
