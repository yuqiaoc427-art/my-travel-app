<div id="tab-plan" class="tab-content">
    <div class="card">
        <strong>â• æ–°å¢/ç·¨è¼¯è¡Œç¨‹èŠ±è²»</strong>
        <input type="date" id="date">
        <input type="text" id="time" placeholder="æ™‚é–“">
        <input type="text" id="activity" placeholder="æ´»å‹•åœ°é» (ä¾‹å¦‚ï¼šæ±äº¬éµå¡”)">
        
        <div style="background: #fdf2f2; padding: 10px; border-radius: 8px; margin-top: 10px;">
            <input type="number" id="cost" placeholder="å¯¦æ”¯é‡‘é¡ (æœªç™¼ç”Ÿè«‹ç•™ç™½)">
            <div style="font-size:12px; margin: 5px 0;">åƒèˆ‡æˆå“¡ï¼š</div>
            <div id="dynamic-member-selection" class="member-grid"></div>
        </div>
        
        <button onclick="saveTrip()">ç¢ºèªå„²å­˜</button>
        <p style="font-size: 11px; color: gray;">* è¦åŠƒæœŸå¯å…ˆå¡«æ—¥æœŸåœ°é»ï¼›å¯¦éš›æ¶ˆè²»å¾Œå†å›ä¾†è£œé‡‘é¡å‹¾é¸æˆå“¡å³å¯ã€‚</p>
    </div>

    <div class="card" style="overflow-x:auto;">
        <table>
            <thead><tr><th>æ™‚é–“/è¡Œç¨‹</th><th>èŠ±è²»æ˜ç´°</th><th>æ“ä½œ</th></tr></thead>
            <tbody id="trip-list"></tbody>
        </table>
    </div>
</div>

<script type="module">
    // ... å‰é¢çš„ Firebase åˆå§‹åŒ–ä¿æŒä¸è®Š ...

    // å„ªåŒ–çš„è¡Œç¨‹åˆ—è¡¨é¡¯ç¤º
    onSnapshot(q, (snapshot) => {
        let listHtml = '';
        // ... (è¨ˆç®—é‚è¼¯ä¸è®Š) ...

        snapshot.forEach(docSnap => {
            const data = docSnap.data();
            const mems = data.members || [];
            
            // åˆ¤æ–·æ˜¯å¦å·²è¨˜å¸³
            const costInfo = data.cost > 0 
                ? `<span class="cost">$${data.cost}</span><br><span class="names">${mems.join(',')}</span>`
                : `<button onclick="fillData('${docSnap.id}')" style="background:#ffc107; color:black; padding:2px 8px; font-size:11px; width:auto;">ğŸ’¸ è£œè¨˜å¸³</button>`;

            listHtml += `<tr>
                <td><small>${data.date} ${data.time}</small><br><b>${data.activity}</b></td>
                <td id="info-${docSnap.id}">${costInfo}</td>
                <td><button onclick="deleteTrip('${docSnap.id}')" ...>âœ•</button></td>
            </tr>`;
        });
        document.getElementById('trip-list').innerHTML = listHtml;
    });

    // é»æ“Šã€Œè£œè¨˜å¸³ã€æ™‚ï¼Œè‡ªå‹•æŠŠè¡Œç¨‹è³‡è¨Šå¡«å›è¼¸å…¥æ¡†
    window.fillData = async (id) => {
        // å…ˆå¾è³‡æ–™åº«æŠ“é€™ç­†è¡Œç¨‹
        const docRef = doc(db, "trips", id);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
            const data = docSnap.data();
            document.getElementById('date').value = data.date;
            document.getElementById('time').value = data.time;
            document.getElementById('activity').value = data.activity;
            // æ²å‹•åˆ°é ‚éƒ¨è®“ä½¿ç”¨è€…è¼¸å…¥é‡‘é¡
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // ä¸¦åˆªé™¤èˆŠçš„ï¼Œç­‰ä¸€ä¸‹å„²å­˜æ–°çš„ (æˆ–æ˜¯ä½ å¯ä»¥æ”¹æˆç”¨ updateDoc)
            // ç‚ºäº†æ–°æ‰‹ç†è§£ç°¡å–®ï¼Œæˆ‘å€‘å…ˆç”¨ã€Œå¡«å…¥å¾Œæ‰‹å‹•æ›´æ–°ã€
            alert("å·²å¸¶å…¥è¡Œç¨‹è³‡è¨Šï¼Œè«‹è£œä¸Šé‡‘é¡èˆ‡å‹¾é¸æˆå“¡å¾Œå†æ¬¡æŒ‰ä¸‹ã€Œç¢ºèªå„²å­˜ã€ï¼Œä¸¦åˆªé™¤èˆŠçš„ç´€éŒ„ã€‚");
        }
    };
</script>
